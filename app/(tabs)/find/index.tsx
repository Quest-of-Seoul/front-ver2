import { useState, useEffect } from "react";
import { Pressable, ScrollView, StyleSheet, Text, View, TextInput, Image, ActivityIndicator } from "react-native";
import { pointsApi, questApi, type Quest } from "@/services/api";
import * as Location from "expo-location";
import Svg, { Path, Defs, RadialGradient, Stop } from "react-native-svg";
import { LinearGradient } from "expo-linear-gradient";
import { useQuestStore } from "@/store/useQuestStore";
import { router, useLocalSearchParams } from "expo-router";

type SortByType = "nearest" | "rewarded" | "newest";

export default function FindScreen() {
  const params = useLocalSearchParams();
  const { selectedQuests, addQuest, removeQuest, startQuest } = useQuestStore();
  const [userMint, setUserMint] = useState<number>(0);
  const [searchQuery, setSearchQuery] = useState("");
  const [searchResults, setSearchResults] = useState<Quest[]>([]);
  const [loading, setLoading] = useState(false);

  const [selectedSort, setSelectedSort] = useState<SortByType>("nearest");
  const [selectedThemes, setSelectedThemes] = useState<string[]>(["All Themes"]);
  const [selectedDistricts, setSelectedDistricts] = useState<string[]>(["All Districts"]);

  useEffect(() => {
    fetchUserPoints();
    getUserLocation();
  }, []);

  // Update filters when coming back from filter page
  useEffect(() => {
    if (params.fromFilter === "true") {
      if (params.selectedThemes) {
        setSelectedThemes((params.selectedThemes as string).split(","));
      }
      if (params.selectedDistricts) {
        setSelectedDistricts((params.selectedDistricts as string).split(","));
      }
      if (params.selectedSort) {
        setSelectedSort(params.selectedSort as SortByType);
      }
    }
  }, [params.fromFilter, params.selectedThemes, params.selectedDistricts, params.selectedSort]);

  const fetchUserPoints = async () => {
    try {
      const data = await pointsApi.getPoints();
      setUserMint(data.total_points);
      console.log("User mint points:", data.total_points);
    } catch (err) {
      console.error("Failed to fetch user points:", err);
    }
  };

  const getUserLocation = async () => {
    const { status } = await Location.requestForegroundPermissionsAsync();
    if (status !== "granted") {
      console.log("Location permission denied");
      return;
    }

    const location = await Location.getCurrentPositionAsync({});
    // setUserLocation({
    //   latitude: location.coords.latitude,
    //   longitude: location.coords.longitude,
    // });
    console.log("User location:", location.coords.latitude, location.coords.longitude);
  };

  // Fetch quests with filters (with optional search debounce)
  useEffect(() => {
    const fetchQuests = async () => {
      setLoading(true);
      try {
        const filterParams = {
          latitude: 37.5665,
          longitude: 126.9780,
          radius_km: 50.0,
          limit: 100,
          sort_by: selectedSort,
          categories: selectedThemes.includes("All Themes")
            ? []
            : selectedThemes.map(theme =>
                theme === "Attractions" ? "Attraction" : theme
              ),
          districts: selectedDistricts.includes("All Districts")
            ? []
            : selectedDistricts.map(d => d.replace("-district", "-gu")),
        };

        console.log("ðŸ” Using filter API with params:", filterParams);
        const response = await questApi.getFilteredQuests(filterParams);
        console.log("âœ… Filter response:", response);

        if (response && response.quests && Array.isArray(response.quests)) {
          // Client-side filtering by search query (only if search query exists)
          const filteredQuests = searchQuery.trim()
            ? response.quests.filter(quest =>
                quest.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                quest.description?.toLowerCase().includes(searchQuery.toLowerCase())
              )
            : response.quests;

          console.log("âœ… Setting search results with count:", filteredQuests.length);
          setSearchResults(filteredQuests);
        } else {
          console.log("âŒ Invalid response structure:", JSON.stringify(response));
          setSearchResults([]);
        }
      } catch (error) {
        console.error("âŒ Search error:", error);
        setSearchResults([]);
      } finally {
        setLoading(false);
      }
    };

    // Debounce only when there's a search query, otherwise fetch immediately
    if (searchQuery.trim()) {
      const timeoutId = setTimeout(fetchQuests, 500);
      return () => clearTimeout(timeoutId);
    } else {
      fetchQuests();
    }
  }, [searchQuery, selectedThemes, selectedDistricts, selectedSort]);

  const handleRefresh = () => {
    setSearchQuery("");
    setSearchResults([]);
    setSelectedThemes(["All Themes"]);
    setSelectedSort("nearest");
    setSelectedDistricts(["All Districts"]);
  };

  return (
    <View style={styles.outerContainer}>
      <ScrollView style={styles.container} contentContainerStyle={{ paddingBottom: 102 }}>
        <View style={styles.fullHeader}>
        {/* ê²€ìƒ‰ + walk + mint */}
        <View style={styles.topRow}>
          <View style={styles.searchBox}>
            <Svg
              width="16"
              height="16"
              viewBox="0 0 16 16"
              fill="none"
              style={styles.searchIcon}
            >
              <Path
                d="M7.33333 12.6667C10.2789 12.6667 12.6667 10.2789 12.6667 7.33333C12.6667 4.38781 10.2789 2 7.33333 2C4.38781 2 2 4.38781 2 7.33333C2 10.2789 4.38781 12.6667 7.33333 12.6667Z"
                stroke="#34495E"
                strokeOpacity="0.55"
                strokeWidth="1.5"
                strokeLinecap="round"
                strokeLinejoin="round"
              />
              <Path
                d="M14 14L11.1 11.1"
                stroke="#34495E"
                strokeOpacity="0.55"
                strokeWidth="1.5"
                strokeLinecap="round"
                strokeLinejoin="round"
              />
            </Svg>
            <TextInput
              placeholder="Search place name"
              placeholderTextColor="rgba(52, 73, 94, 0.55)"
              value={searchQuery}
              onChangeText={setSearchQuery}
              style={styles.searchInput}
            />
          </View>

          <View style={styles.walkBox}>
            <View style={styles.statColumn}>
              <Svg width="14" height="19" viewBox="0 0 14 19" fill="none">
                <Path
                  d="M4.5858 18.8191L3.41542 18.9879C2.81182 19.0742 1.78496 18.6936 1.70399 18.0461C1.62302 17.4026 2.51737 16.7434 3.12097 16.6531L4.29138 16.4844C4.89498 16.3981 5.92185 16.7827 6.00282 17.4301C6.08379 18.0736 5.1894 18.7328 4.5858 18.8191Z"
                  fill="white"
                  opacity="0.95"
                />
                <Path
                  d="M3.76134 15.6447L3.42645 15.6918C2.1162 15.8802 0.603508 14.9463 0.426844 13.5533L0.0219997 10.3554C-0.0205015 10.0237 -0.00130306 9.68644 0.0785638 9.36275C0.158431 9.03906 0.297396 8.73531 0.487452 8.46891C0.677508 8.20251 0.914951 7.97869 1.18621 7.81021C1.45748 7.64172 1.75722 7.53187 2.06833 7.48699L3.02525 7.34966C3.33657 7.30438 3.65322 7.32505 3.95705 7.41044C4.26088 7.49584 4.54593 7.6443 4.79585 7.84733C5.04577 8.05036 5.25567 8.30395 5.41352 8.59359C5.57136 8.88324 5.67405 9.20326 5.7157 9.53528L6.12055 12.7332C6.29721 14.134 5.06792 15.4642 3.76134 15.6447Z"
                  fill="white"
                  opacity="0.95"
                />
                <Path
                  d="M10.309 11.6502L9.13492 11.5286C8.52764 11.4658 7.6112 10.8419 7.66273 10.1945C7.72161 9.54703 8.73373 9.11934 9.34101 9.18213L10.5151 9.30374C11.1224 9.37045 12.0388 9.99436 11.9873 10.6418C11.9247 11.2892 10.9126 11.7208 10.309 11.6502Z"
                  fill="white"
                  opacity="0.95"
                />
                <Path
                  d="M10.1838 8.36199L9.84521 8.32669C8.53128 8.19328 7.2689 6.91413 7.38667 5.5133L7.6774 2.30356C7.70782 1.97015 7.79958 1.64641 7.94737 1.3508C8.09517 1.0552 8.2961 0.793527 8.53876 0.580733C8.78142 0.367938 9.06104 0.208185 9.36161 0.110606C9.66218 0.0130264 9.97782 -0.0204648 10.2905 0.0120301L11.2512 0.110127C11.8821 0.1766 12.4624 0.507317 12.8648 1.02969C13.2671 1.55206 13.4585 2.22335 13.3969 2.89607L13.1061 6.10576C12.9773 7.50659 11.4978 8.49933 10.1838 8.36199Z"
                  fill="white"
                  opacity="0.95"
                />
              </Svg>
              <Text style={styles.statLabel}>walk</Text>
            </View>
            <Text style={styles.statValue}>0.1</Text>
          </View>

          <View style={styles.mintBox}>
            <View style={styles.statColumn}>
              <Svg width="26" height="16" viewBox="0 0 26 16" fill="none">
                <Path
                  d="M26 7.93746V8.44855C26 9.17179 25.5789 9.78656 24.9296 10.2012C25.7342 10.8232 26.1647 11.7441 25.92 12.612L25.7765 13.0942C25.3813 14.4804 23.4241 15.0108 21.7773 14.1815L20.2812 13.4317C19.8558 13.2212 19.4801 12.9185 19.1802 12.5445C18.9389 12.8886 18.6698 13.2111 18.3756 13.5088C17.5932 14.3118 16.6512 14.9326 15.6136 15.3288C14.576 15.7251 13.4673 15.8876 12.363 15.8053C11.2586 15.7229 10.1845 15.3976 9.21383 14.8516C8.24317 14.3055 7.39873 13.5515 6.738 12.641C6.45213 12.9673 6.10695 13.2334 5.72174 13.4245L4.22558 14.1742C2.57885 15.0035 0.631008 14.4732 0.226384 13.0869L0.0828579 12.6048C-0.152389 11.7465 0.268722 10.8256 1.07327 10.194C0.423985 9.77932 0.00288208 9.15732 0.00288208 8.44131V7.93746C0.0132505 7.59598 0.106971 7.26261 0.27546 6.96781C0.443949 6.67301 0.681828 6.42619 0.967388 6.2499C0.261648 5.68577 -0.140606 4.86369 0.0452391 4.05607L0.158153 3.55942C0.471031 2.20455 2.27536 1.54641 3.93856 2.18527L5.49121 2.78556C5.88189 2.93367 6.24297 3.15341 6.55685 3.43406C7.26949 2.36734 8.22692 1.49633 9.34495 0.897587C10.463 0.298841 11.7074 -0.00930872 12.9688 0.000214193C14.2303 0.0097371 15.4701 0.336647 16.5794 0.952207C17.6887 1.56777 18.6335 2.45313 19.3308 3.5305C19.6676 3.20049 20.0683 2.9467 20.507 2.78556L22.0573 2.18527C23.7228 1.54641 25.5248 2.20455 25.8377 3.55942L25.9506 4.05607C26.1365 4.86369 25.7412 5.68577 25.0284 6.2499C25.3153 6.42532 25.5546 6.67178 25.7243 6.96663C25.8941 7.26149 25.9889 7.5953 26 7.93746Z"
                  fill="white"
                  opacity="0.95"
                />
              </Svg>
              <Text style={styles.statLabel}>mint</Text>
            </View>
            <Text style={styles.statValue}>{userMint}</Text>
          </View>
        </View>

        {/* ìƒˆë¡œê³ ì¹¨ê³¼ í•„í„° */}
        <View style={styles.filterRowContainer}>
          <Pressable style={styles.refreshButton} onPress={handleRefresh}>
            <Svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <Path
                d="M10 20C7.20833 20 4.84375 19.0313 2.90625 17.0938C0.96875 15.1563 0 12.7917 0 10C0 7.20834 0.96875 4.84375 2.90625 2.90625C4.84375 0.968754 7.20833 4.31034e-06 10 4.31034e-06C11.4375 4.31034e-06 12.8125 0.296671 14.125 0.890004C15.4375 1.48334 16.5625 2.3325 17.5 3.4375V1.25C17.5 0.895838 17.62 0.599171 17.86 0.360004C18.1 0.120838 18.3967 0.000837644 18.75 4.31034e-06C19.1033 -0.000829023 19.4004 0.119171 19.6412 0.360004C19.8821 0.600838 20.0017 0.897504 20 1.25V7.5C20 7.85417 19.88 8.15125 19.64 8.39125C19.4 8.63125 19.1033 8.75084 18.75 8.75H12.5C12.1458 8.75 11.8492 8.63 11.61 8.39C11.3708 8.15 11.2508 7.85334 11.25 7.5C11.2492 7.14667 11.3692 6.85 11.61 6.61C11.8508 6.37 12.1475 6.25 12.5 6.25H16.5C15.8333 5.08334 14.9221 4.16667 13.7662 3.5C12.6104 2.83334 11.355 2.5 10 2.5C7.91667 2.5 6.14583 3.22917 4.6875 4.6875C3.22917 6.14584 2.5 7.91667 2.5 10C2.5 12.0833 3.22917 13.8542 4.6875 15.3125C6.14583 16.7708 7.91667 17.5 10 17.5C11.4167 17.5 12.7137 17.1408 13.8912 16.4225C15.0687 15.7042 15.98 14.7404 16.625 13.5313C16.7917 13.2396 17.0263 13.0367 17.3288 12.9225C17.6313 12.8083 17.9383 12.8029 18.25 12.9063C18.5833 13.0104 18.8229 13.2292 18.9687 13.5625C19.1146 13.8958 19.1042 14.2083 18.9375 14.5C18.0833 16.1667 16.8646 17.5 15.2813 18.5C13.6979 19.5 11.9375 20 10 20Z"
                fill="white"
              />
            </Svg>
          </Pressable>

          <View style={styles.filterCategoryRow}>
            <Pressable
              onPress={() => router.push("/(tabs)/find/filter")}
            >
              <Svg
                width="30"
                height="30"
                viewBox="0 0 30 30"
                fill="none"
                style={styles.filterIcon}
              >
                <Path
                  d="M26.5625 15H11.1188M5.6675 15H3.4375M5.6675 15C5.6675 14.2773 5.9546 13.5842 6.46563 13.0731C6.97667 12.5621 7.66979 12.275 8.3925 12.275C9.11522 12.275 9.80833 12.5621 10.3194 13.0731C10.8304 13.5842 11.1175 14.2773 11.1175 15C11.1175 15.7227 10.8304 16.4158 10.3194 16.9269C9.80833 17.4379 9.11522 17.725 8.3925 17.725C7.66979 17.725 6.97667 17.4379 6.46563 16.9269C5.9546 16.4158 5.6675 15.7227 5.6675 15ZM26.5625 23.2587H19.3775M19.3775 23.2587C19.3775 23.9816 19.0897 24.6755 18.5786 25.1867C18.0674 25.6978 17.3741 25.985 16.6513 25.985C15.9285 25.985 15.2354 25.6966 14.7244 25.1856C14.2133 24.6746 13.9262 23.9815 13.9262 23.2587M19.3775 23.2587C19.3775 22.5359 19.0897 21.8432 18.5786 21.3321C18.0674 20.8209 17.3741 20.5337 16.6513 20.5337C15.9285 20.5337 15.2354 20.8208 14.7244 21.3319C14.2133 21.8429 13.9262 22.536 13.9262 23.2587M13.9262 23.2587H3.4375M26.5625 6.74124H22.6813M17.23 6.74124H3.4375M17.23 6.74124C17.23 6.01852 17.5171 5.32541 18.0281 4.81437C18.5392 4.30333 19.2323 4.01624 19.955 4.01624C20.3129 4.01624 20.6672 4.08672 20.9978 4.22366C21.3284 4.36061 21.6288 4.56133 21.8819 4.81437C22.1349 5.06741 22.3356 5.36781 22.4726 5.69842C22.6095 6.02904 22.68 6.38338 22.68 6.74124C22.68 7.09909 22.6095 7.45344 22.4726 7.78405C22.3356 8.11466 22.1349 8.41506 21.8819 8.6681C21.6288 8.92114 21.3284 9.12186 20.9978 9.25881C20.6672 9.39575 20.3129 9.46623 19.955 9.46623C19.2323 9.46623 18.5392 9.17914 18.0281 8.6681C17.5171 8.15706 17.23 7.46395 17.23 6.74124Z"
                  stroke="white"
                  strokeWidth="1.875"
                  strokeMiterlimit="10"
                  strokeLinecap="round"
                />
              </Svg>
            </Pressable>

            <ScrollView
              horizontal
              showsHorizontalScrollIndicator={false}
              contentContainerStyle={{ paddingRight: 16 }}
            >
              {/* Themes */}
              {selectedThemes.map((theme) => (
                <View key={theme} style={styles.categoryChipActive}>
                  <Text style={styles.categoryTextActive}>{theme}</Text>
                </View>
              ))}

              {/* Sort */}
              <View style={styles.sortButtonActive}>
                <Svg width="12" height="12" viewBox="0 0 12 12" fill="none">
                  <Path
                    d="M0.702404 4.91659L10.515 0.198826C11.8218 -0.304898 12.2965 0.157875 11.8177 1.48066L7.27664 11.2848C7.19557 11.5085 7.0441 11.6992 6.84541 11.8277C6.64672 11.9563 6.41175 12.0156 6.1765 11.9965C5.94125 11.9775 5.7187 11.8811 5.54286 11.7223C5.36702 11.5634 5.24762 11.3508 5.20293 11.1169C4.88639 9.47878 2.79239 7.36153 1.14478 7.05438L0.876926 7.00114C0.645723 6.95733 0.435121 6.8382 0.277417 6.66205C0.119713 6.4859 0.0236217 6.26241 0.00381896 6.02586C-0.0159837 5.7893 0.041604 5.55272 0.16779 5.35237C0.293975 5.15201 0.481761 4.99892 0.702404 4.91659Z"
                    fill="#659DF2"
                  />
                </Svg>
                <Text style={styles.sortTextActive}>
                  {selectedSort === "nearest" ? "Nearest Trip" : selectedSort === "rewarded" ? "Most Rewarded" : "Newest"}
                </Text>
              </View>

              {/* Districts */}
              {selectedDistricts.map((district) => (
                <View key={district} style={styles.districtChipActive}>
                  <Text style={styles.districtTextActive}>{district}</Text>
                </View>
              ))}
            </ScrollView>
          </View>
        </View>
      </View>

      {/* ê²€ìƒ‰ ê²°ê³¼ */}
      {loading && (
        <View style={styles.loadingContainer}>
          <ActivityIndicator size="large" color="#FFF" />
        </View>
      )}

      {!loading && searchResults.length > 0 && (
        <View style={styles.resultsContainer}>
          <Text style={styles.resultsTitle}>
            {searchQuery ? `Found ${searchResults.length} place${searchResults.length > 1 ? 's' : ''}` : `${searchResults.length} places available`}
          </Text>
          <View style={styles.resultsGrid}>
            {searchResults.map((quest) => (
              <View
                key={quest.id}
                style={styles.cardWrapper}
              >
                <View style={styles.placeImageContainer}>
                  {quest.place_image_url && (
                    <Image
                      source={{ uri: quest.place_image_url }}
                      style={styles.placeImage}
                    />
                  )}
                  <Text style={styles.placeCategoryText}>{quest.category || 'Place'}</Text>
                  <Pressable
                    style={styles.plusButton}
                    onPress={() => addQuest(quest)}
                  >
                    <Svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                      <Path d="M14.8571 9.14286H9.14286V14.8571C9.14286 15.1602 9.02245 15.4509 8.80812 15.6653C8.59379 15.8796 8.30311 16 8 16C7.6969 16 7.40621 15.8796 7.19188 15.6653C6.97755 15.4509 6.85714 15.1602 6.85714 14.8571V9.14286H1.14286C0.839753 9.14286 0.549063 9.02245 0.334735 8.80812C0.120408 8.59379 0 8.30311 0 8C0 7.6969 0.120408 7.40621 0.334735 7.19188C0.549063 6.97755 0.839753 6.85714 1.14286 6.85714H6.85714V1.14286C6.85714 0.839753 6.97755 0.549062 7.19188 0.334735C7.40621 0.120407 7.6969 0 8 0C8.30311 0 8.59379 0.120407 8.80812 0.334735C9.02245 0.549062 9.14286 0.839753 9.14286 1.14286V6.85714H14.8571C15.1602 6.85714 15.4509 6.97755 15.6653 7.19188C15.8796 7.40621 16 7.6969 16 8C16 8.30311 15.8796 8.59379 15.6653 8.80812C15.4509 9.02245 15.1602 9.14286 14.8571 9.14286Z" fill="white"/>
                    </Svg>
                  </Pressable>
                  {quest.distance_km !== undefined && (
                    <View style={styles.distanceBadge}>
                      <Svg width="10" height="10" viewBox="0 0 10 10" fill="none">
                        <Path d="M9.49609 0.501953C9.4967 0.511802 9.50014 0.523321 9.5 0.537109C9.49887 0.64138 9.4678 0.808104 9.38184 1.04883L5.61035 9.19434L5.60156 9.21387L5.59375 9.2334C5.56315 9.31782 5.50604 9.38903 5.43262 9.43652C5.35932 9.48388 5.27333 9.50595 5.1875 9.49902C5.1016 9.49207 5.01943 9.45648 4.9541 9.39746C4.88881 9.33843 4.84406 9.25842 4.82715 9.16992V9.16895L4.79199 9.01465C4.59556 8.24175 4.04883 7.43937 3.41504 6.80273C2.7393 6.12398 1.87207 5.54092 1.04492 5.38672L0.828125 5.34375L0.824219 5.34277L0.761719 5.32617C0.701821 5.30413 0.647322 5.2667 0.603516 5.21777C0.545136 5.15242 0.508439 5.06864 0.500977 4.97949C0.493596 4.89034 0.515442 4.8013 0.5625 4.72656C0.609571 4.65182 0.679301 4.59552 0.759766 4.56543L0.78125 4.55762L0.801758 4.54785L8.95898 0.625C9.19511 0.535375 9.35976 0.503188 9.46289 0.5C9.47568 0.499607 9.48672 0.501617 9.49609 0.501953Z" stroke="#F5F5F5"/>
                      </Svg>
                      <Text style={styles.distanceText}>{quest.distance_km.toFixed(1)}km</Text>
                    </View>
                  )}
                </View>
                <View style={styles.placeInfoBottom}>
                  <Text style={styles.placeNameText} numberOfLines={2}>{quest.name}</Text>
                  {quest.district && (
                    <Text style={styles.placeLocationText}>{quest.district}</Text>
                  )}
                </View>
              </View>
            ))}
          </View>
        </View>
      )}

      {!loading && searchQuery && searchResults.length === 0 && (
        <View style={styles.noResultsContainer}>
          <Image
            source={require("@/assets/images/docent_face.png")}
            style={styles.docentFaceImage}
          />
          <Svg
            width="130"
            height="46"
            viewBox="0 0 130 46"
            fill="none"
            style={styles.oopsText}
          >
            <Path
              d="M15.936 36.3333C12.5016 36.3333 9.59688 35.5873 7.22173 34.0952C4.84658 32.6032 3.04918 30.5397 1.82951 27.9048C0.609835 25.2698 0 22.2381 0 18.8095C0 15.4127 0.609835 12.3968 1.82951 9.76191C3.04918 7.09524 4.84658 5.01587 7.22173 3.52381C9.59688 2 12.5016 1.2381 15.936 1.2381C19.3703 1.2381 22.259 2 24.602 3.52381C26.9772 5.01587 28.7746 7.09524 29.9943 9.76191C31.2139 12.3968 31.8238 15.4127 31.8238 18.8095C31.8238 22.2381 31.2139 25.2698 29.9943 27.9048C28.7746 30.5397 26.9772 32.6032 24.602 34.0952C22.259 35.5873 19.3703 36.3333 15.936 36.3333ZM6.06625 18.0476C6.06625 19.0317 6.30698 19.9683 6.78843 20.8571C7.26988 21.7143 8.21672 22.4127 9.62897 22.9524C11.0412 23.4603 13.1436 23.7143 15.936 23.7143C18.7284 23.7143 20.8146 23.4603 22.1948 22.9524C23.607 22.4127 24.5539 21.7143 25.0353 20.8571C25.5168 19.9683 25.7575 19.0317 25.7575 18.0476C25.7575 17.0317 25.5168 16.127 25.0353 15.3333C24.5539 14.5079 23.607 13.8571 22.1948 13.381C20.8146 12.873 18.7284 12.619 15.936 12.619C13.1436 12.619 11.0412 12.873 9.62897 13.381C8.21672 13.8571 7.26988 14.5079 6.78843 15.3333C6.30698 16.127 6.06625 17.0317 6.06625 18.0476Z"
              fill="#FEF5E7"
            />
            <Path
              d="M45.7997 36.2857C42.0444 36.2857 39.0434 35.1905 36.7966 33C34.5819 30.7778 33.4746 27.6508 33.4746 23.619C33.4746 21.1429 33.9881 18.9683 35.0152 17.0952C36.0423 15.2222 37.4706 13.7619 39.3001 12.7143C41.1617 11.6349 43.3283 11.0952 45.7997 11.0952C48.56 11.0952 50.8549 11.6349 52.6844 12.7143C54.5139 13.7619 55.878 15.2222 56.7767 17.0952C57.7075 18.9683 58.1729 21.1429 58.1729 23.619C58.1729 27.6508 57.1458 30.7778 55.0917 33C53.0696 35.1905 49.9722 36.2857 45.7997 36.2857ZM39.2038 22.8095C39.2038 23.7937 39.7013 24.4921 40.6963 24.9048C41.6913 25.2857 43.3924 25.4762 45.7997 25.4762C48.2069 25.4762 49.9081 25.2857 50.903 24.9048C51.898 24.4921 52.3955 23.7937 52.3955 22.8095C52.3955 21.8571 51.898 21.1905 50.903 20.8095C49.9081 20.4286 48.2069 20.2381 45.7997 20.2381C43.3924 20.2381 41.6913 20.4286 40.6963 20.8095C39.7013 21.1905 39.2038 21.8571 39.2038 22.8095Z"
              fill="#FEF5E7"
            />
            <Path
              d="M77.0867 36.1905C75.3214 36.1905 73.845 35.6508 72.6574 34.5714C71.5019 33.4921 70.7637 32.0952 70.4427 30.381H69.5761V41.3333C69.5761 42.6349 69.207 43.7302 68.4688 44.619C67.7306 45.5397 66.6072 46 65.0986 46C63.6543 46 62.5309 45.5397 61.7285 44.619C60.9582 43.7302 60.573 42.6032 60.573 41.2381V23.4286C60.573 21.8413 60.5088 20.5079 60.3804 19.4286C60.2841 18.3175 60.1879 17.3175 60.0916 16.4286C59.9632 15.0952 60.236 13.9683 60.91 13.0476C61.5841 12.0952 62.6753 11.5238 64.1839 11.3333C66.1418 11.0794 67.5219 11.4286 68.3243 12.381C69.1589 13.3016 69.5761 14.746 69.5761 16.7143V19L69.7687 19.0476C69.9292 17.8095 70.2983 16.6032 70.876 15.4286C71.4859 14.2222 72.3364 13.2381 73.4277 12.4762C74.519 11.6825 75.8991 11.2857 77.5682 11.2857C80.3606 11.2857 82.4308 12.3968 83.7788 14.619C85.159 16.8095 85.8491 19.746 85.8491 23.4286C85.8491 31.9365 82.9283 36.1905 77.0867 36.1905ZM69.3835 23.3333C69.3835 23.8413 69.4477 24.2381 69.5761 24.5238C69.7687 25.127 70.1699 25.5714 70.7797 25.8571C71.4217 26.1111 72.3685 26.2381 73.6203 26.2381C75.2251 26.2381 76.3164 26 76.8941 25.5238C77.504 25.0476 77.8089 24.3175 77.8089 23.3333C77.8089 22.3175 77.52 21.5873 76.9423 21.1429C76.3645 20.6667 75.2733 20.4286 73.6684 20.4286C72.3846 20.4286 71.4217 20.5714 70.7797 20.8571C70.1699 21.1111 69.7687 21.5397 69.5761 22.1429C69.4477 22.4286 69.3835 22.8254 69.3835 23.3333Z"
              fill="#FEF5E7"
            />
            <Path
              d="M100.386 36.8095C98.1712 36.8095 96.117 36.6032 94.2233 36.1905C92.3617 35.746 90.8692 35.0635 89.7458 34.1429C88.6224 33.1905 88.0607 31.9365 88.0607 30.381C88.0607 29.0159 88.478 27.8889 89.3125 27C90.147 26.1111 91.2543 25.6667 92.6345 25.6667C93.5011 25.6667 94.3677 25.8095 95.2343 26.0952C96.133 26.3492 97.0799 26.6032 98.0749 26.8571C99.0699 27.1111 100.145 27.2381 101.301 27.2381C102.328 27.2381 103.018 27.1905 103.371 27.0952C103.724 26.9683 103.9 26.746 103.9 26.4286C103.9 26.0476 103.676 25.7937 103.226 25.6667C102.809 25.5397 102.087 25.381 101.06 25.1905L97.5934 24.5238C96.1491 24.2381 94.7368 23.873 93.3567 23.4286C92.0086 22.9524 90.8852 22.254 89.9865 21.3333C89.1199 20.4127 88.6866 19.1587 88.6866 17.5714C88.6866 15.4127 89.6495 13.7302 91.5753 12.5238C93.5332 11.3175 96.3577 10.7143 100.049 10.7143C102.167 10.7143 104.061 10.9206 105.73 11.3333C107.431 11.746 108.779 12.3651 109.774 13.1905C110.769 13.9841 111.267 14.9841 111.267 16.1905C111.299 17.4921 110.946 18.5397 110.207 19.3333C109.469 20.127 108.538 20.5238 107.415 20.5238C106.613 20.5238 105.794 20.4286 104.96 20.2381C104.157 20.0159 103.275 19.7937 102.312 19.5714C101.381 19.3175 100.306 19.1746 99.0859 19.1429C98.2193 19.0794 97.5132 19.127 96.9675 19.2857C96.4219 19.4444 96.1491 19.6984 96.1491 20.0476C96.1491 20.4286 96.47 20.6984 97.112 20.8571C97.7539 20.9841 98.7168 21.1587 100.001 21.381L103.419 22C105.505 22.3492 107.158 22.7937 108.378 23.3333C109.63 23.8413 110.528 24.5556 111.074 25.4762C111.62 26.3968 111.892 27.6667 111.892 29.2857C111.892 30.9683 111.395 32.381 110.4 33.5238C109.437 34.6349 108.089 35.4603 106.356 36C104.623 36.5397 102.633 36.8095 100.386 36.8095Z"
              fill="#FEF5E7"
            />
            <Path
              d="M116.805 6.57143C116.773 5.42857 116.966 4.36508 117.383 3.38095C117.832 2.36508 118.554 1.55556 119.549 0.952383C120.544 0.317461 121.828 0 123.401 0C125.006 0 126.29 0.317461 127.253 0.952383C128.248 1.55556 128.954 2.36508 129.371 3.38095C129.82 4.36508 130.029 5.42857 129.997 6.57143C129.965 7.61905 129.804 8.60318 129.515 9.52381C129.226 10.4444 128.889 11.3968 128.504 12.381C128.119 13.3333 127.766 14.3968 127.445 15.5714C127.124 16.7143 126.916 18.0317 126.819 19.5238C126.723 20.7619 126.37 21.6825 125.76 22.2857C125.15 22.8571 124.364 23.1429 123.401 23.1429C122.406 23.1429 121.604 22.8571 120.994 22.2857C120.384 21.7143 120.047 20.7937 119.983 19.5238C119.886 18.0317 119.678 16.7143 119.357 15.5714C119.036 14.3968 118.683 13.3333 118.298 12.381C117.912 11.3968 117.575 10.4444 117.287 9.52381C116.998 8.60318 116.837 7.61905 116.805 6.57143ZM123.401 37.0952C121.507 37.0952 120.031 36.6032 118.972 35.619C117.912 34.6032 117.383 33.2698 117.383 31.619C117.383 29.9365 117.912 28.5714 118.972 27.5238C120.063 26.4762 121.539 25.9524 123.401 25.9524C125.198 25.9524 126.627 26.4762 127.686 27.5238C128.745 28.5397 129.275 29.8889 129.275 31.5714C129.275 33.2222 128.761 34.5556 127.734 35.5714C126.707 36.5873 125.263 37.0952 123.401 37.0952Z"
              fill="#FEF5E7"
            />
          </Svg>
          <View style={styles.noResultsTextContainer}>
            <Text style={styles.noResultsText}>
              <Text style={styles.noResultsRegular}>I can&apos;t find </Text>
              <Text style={styles.noResultsBold}>{searchQuery}</Text>
            </Text>
          </View>
        </View>
      )}

      {!loading && searchResults.length === 0 && (
        <>
          {/* Image-based recommendation card */}
          <Pressable style={styles.recommendationCard}>
            <View style={styles.cardImagesContainer}>
              <Image
                source={require("@/assets/images/rion.png")}
                style={styles.rionImage}
              />
              <Image
                source={require("@/assets/images/icon-map-small.png")}
                style={styles.mapIconImage}
              />
            </View>
            <View style={styles.cardTextContainer}>
              <Text style={styles.cardTitle}>
                Image-Based{"\n"}Recommendations
              </Text>
              <Text style={styles.cardDescription}>
                Show me an image of the place! I will find out similar places for you
              </Text>
            </View>
          </Pressable>

          {/* Try it right away button */}
          <View style={styles.tryItButtonContainer}>
            <Pressable>
              <LinearGradient
                colors={["#659DF2", "#76C7AD"]}
                start={{ x: 0, y: 0 }}
                end={{ x: 1, y: 0 }}
                style={styles.tryItButton}
              >
                <Svg width="24" height="24" viewBox="0 0 24 24" fill="none" style={styles.tryItIcon}>
                  <Path
                    d="M10.9428 20.0065H3.17648C1.31348 20.0065 0.0116938 18.5563 0.0116938 16.4798C0.0116938 15.4397 0.0116938 14.4021 0.0116938 13.3669C0.0116938 11.1311 0.0116825 8.82018 0.000162235 6.54775C-0.00413788 6.07209 0.0770848 5.60031 0.23903 5.16006C0.400975 4.71982 0.640371 4.32 0.943177 3.98418C1.24013 3.6611 1.59336 3.40901 1.9811 3.24337C2.36883 3.07774 2.78291 3.00211 3.1979 3.02106C3.77062 3.03937 4.34991 3.03567 4.94896 3.03017H4.96544C5.02798 1.28145 6.19314 0.0143133 7.77307 0.00698878C9.83026 -0.00216683 11.9188 -0.00216683 13.9776 0.00698878C15.5526 0.00698878 16.7178 1.27595 16.7852 3.02284H17.0782C17.6641 3.02284 18.2697 3.02286 18.8753 3.04484C19.6514 3.07957 20.3847 3.44961 20.9194 4.07636C21.4542 4.70312 21.7482 5.53719 21.739 6.4013C21.739 7.10811 21.739 7.8149 21.739 8.52171C21.739 8.76453 21.6523 8.99743 21.4979 9.16913C21.3436 9.34083 21.1343 9.43727 20.9161 9.43727C20.6979 9.43727 20.4885 9.34083 20.3342 9.16913C20.1799 8.99743 20.0932 8.76453 20.0932 8.52171C20.0932 7.82039 20.0932 7.11724 20.0932 6.41409C20.1043 6.02008 19.9749 5.63717 19.7331 5.34899C19.4914 5.0608 19.157 4.89076 18.8029 4.87596C18.2401 4.84849 17.6509 4.85214 17.0881 4.8558C16.8247 4.8558 16.5631 4.8558 16.2997 4.8558H16.1994C15.9104 4.82486 15.6421 4.67536 15.4468 4.43638C15.2514 4.19739 15.1431 3.88608 15.1428 3.56306C15.1428 3.43122 15.1428 3.30302 15.1428 3.17484C15.1428 2.36915 14.6754 1.84911 13.971 1.84544C11.9171 1.83629 9.83521 1.83629 7.78295 1.84544C7.07692 1.84544 6.61777 2.36914 6.60955 3.16934C6.60955 3.30301 6.60955 3.43305 6.60955 3.56673C6.61 3.90836 6.48921 4.23636 6.27348 4.47947C6.05776 4.72258 5.76454 4.8611 5.45752 4.86496H4.96379C4.34169 4.86496 3.75416 4.86495 3.15346 4.85397C2.95993 4.84157 2.76617 4.87448 2.58476 4.95048C2.40334 5.02649 2.23826 5.14395 2.10015 5.2953C1.95316 5.45913 1.83757 5.65444 1.76035 5.8694C1.68313 6.08436 1.64587 6.31453 1.65086 6.54597C1.66732 8.82755 1.66404 11.1421 1.66239 13.3834C1.66239 14.4234 1.66239 15.4611 1.66239 16.4963C1.66239 17.5583 2.23018 18.1919 3.18142 18.1919H10.9477C11.166 18.1919 11.3753 18.2884 11.5296 18.4601C11.6839 18.6318 11.7706 18.8646 11.7706 19.1074C11.7706 19.3503 11.6839 19.5832 11.5296 19.7549C11.3753 19.9266 11.166 20.023 10.9477 20.023L10.9428 20.0065Z"
                    fill="white"
                  />
                  <Path
                    d="M23.9999 13.9725C24.0043 14.4552 23.8555 14.9268 23.5751 15.3196C23.2946 15.7125 22.8969 16.0064 22.439 16.1591L16.7906 18.1009C16.6474 18.1512 16.4992 18.186 16.3485 18.2046V22.4979C16.3485 22.8453 16.2106 23.1785 15.9651 23.4243C15.7197 23.6701 15.3866 23.8084 15.0392 23.8089C14.692 23.808 14.3592 23.6695 14.1138 23.4238C13.8685 23.1781 13.7304 22.8452 13.73 22.4979V16.0197C13.73 15.984 13.73 15.95 13.73 15.9143V12.0307C13.73 11.9967 13.73 11.961 13.73 11.927C13.7351 11.8127 13.7493 11.699 13.7725 11.5869C13.8368 11.2633 13.9697 10.9572 14.1621 10.6892C14.3545 10.4212 14.602 10.1974 14.888 10.033C15.1741 9.86854 15.492 9.76725 15.8204 9.73584C16.1489 9.70444 16.4802 9.74366 16.7923 9.85092L22.4407 11.7927C22.8972 11.9453 23.2937 12.2383 23.5737 12.6298C23.8538 13.0213 24.0029 13.4912 23.9999 13.9725Z"
                    fill="white"
                  />
                  <Path
                    d="M11.2171 15.1266C10.5179 15.127 9.82899 14.9589 9.20862 14.6364C8.58825 14.314 8.05474 13.8467 7.65334 13.2743C7.25194 12.7018 6.99447 12.0411 6.90272 11.3479C6.81098 10.6548 6.88767 9.94978 7.12631 9.2926C7.36495 8.63543 7.7585 8.04547 8.27361 7.57273C8.78872 7.09998 9.4102 6.75836 10.0854 6.57686C10.7606 6.39535 11.4696 6.37929 12.1523 6.53003C12.835 6.68078 13.4713 6.9939 14.0073 7.44284C14.1803 7.58759 14.2886 7.79512 14.3085 8.01977C14.3285 8.24441 14.2584 8.46776 14.1136 8.6407C13.9689 8.81364 13.7613 8.92202 13.5367 8.94195C13.312 8.96188 13.0886 8.89173 12.9157 8.74697C12.5894 8.47439 12.2022 8.28443 11.7869 8.19316C11.3716 8.10189 10.9404 8.11201 10.5299 8.22263C10.1193 8.33326 9.74139 8.54118 9.42818 8.82875C9.11496 9.11632 8.87562 9.47508 8.7304 9.87472C8.58519 10.2744 8.53837 10.7031 8.59391 11.1247C8.64945 11.5462 8.80569 11.9482 9.04946 12.2966C9.29323 12.645 9.61734 12.9296 9.99435 13.1262C10.3714 13.3228 10.7902 13.4257 11.2154 13.4263C11.4409 13.4263 11.6571 13.5159 11.8166 13.6753C11.976 13.8347 12.0655 14.0509 12.0655 14.2764C12.0655 14.5019 11.976 14.7182 11.8166 14.8776C11.6571 15.037 11.4409 15.1266 11.2154 15.1266H11.2171Z"
                    fill="white"
                  />
                </Svg>
                <Text style={styles.tryItText}>Try it right away</Text>
                <Svg width="9" height="17" viewBox="0 0 9 17" fill="none" style={styles.tryItArrow}>
                  <Path
                    d="M0.235394 15.2704C0.160212 15.3499 0.101438 15.4435 0.0624246 15.5458C0.0234117 15.648 0.0049246 15.757 0.00801988 15.8664C0.0111152 15.9758 0.0357319 16.0836 0.0804641 16.1835C0.125196 16.2834 0.189168 16.3735 0.268727 16.4487C0.348286 16.5239 0.441875 16.5826 0.544149 16.6217C0.646423 16.6607 0.755379 16.6792 0.864798 16.6761C0.974216 16.673 1.08195 16.6483 1.18186 16.6036C1.28176 16.5589 1.37188 16.4949 1.44706 16.4154L8.53039 8.91535C8.67667 8.76063 8.75818 8.55578 8.75818 8.34285C8.75818 8.12993 8.67667 7.92508 8.53039 7.77035L1.44706 0.269518C1.37238 0.188217 1.28228 0.122565 1.18201 0.0763782C1.08174 0.030191 0.973286 0.00438871 0.862958 0.000468836C0.752629 -0.00345103 0.642621 0.014591 0.539324 0.0535455C0.436026 0.0925001 0.341498 0.15159 0.261231 0.227386C0.180964 0.303182 0.116557 0.394171 0.0717521 0.495068C0.0269469 0.595965 0.00263659 0.70476 0.000232852 0.815132C-0.00217088 0.925504 0.0173797 1.03525 0.0577497 1.13801C0.0981197 1.24076 0.158504 1.33447 0.235395 1.41368L6.77873 8.34285L0.235394 15.2704Z"
                    fill="white"
                  />
                </Svg>
              </LinearGradient>
            </Pressable>
          </View>

          {/* AI Docent Card */}
          <Pressable style={styles.aiDocentCard}>
            <View style={styles.aiDocentIconContainer}>
              <Svg width="70" height="70" viewBox="0 0 70 70" fill="none">
                <Path
                  d="M35 0C52.1208 2.47396e-05 66 13.8792 66 31C66 48.1208 52.1208 62 35 62C17.8792 62 4.00001 48.1208 4 31C4 13.8792 17.8792 0 35 0ZM45.1484 31.668C44.8921 31.6667 44.6435 31.7554 44.4453 31.918C44.2472 32.0805 44.1122 32.307 44.0635 32.5586C43.632 33.881 43.1442 35.148 42.6709 36.54C42.632 36.6642 42.5636 36.7771 42.4717 36.8691C42.3796 36.9612 42.2668 37.0304 42.1426 37.0693L38.0918 38.5312C37.8566 38.5936 37.6484 38.7324 37.502 38.9268C37.3739 39.0968 37.2995 39.3005 37.2861 39.5117L37.2822 39.6934C37.2881 39.9032 37.3581 40.1074 37.4824 40.2783C37.6246 40.4735 37.8298 40.614 38.0635 40.6748L42.1562 42.1641C42.2745 42.2 42.3824 42.2642 42.4697 42.3516C42.5571 42.439 42.6214 42.5468 42.6572 42.665C43.0748 43.9873 43.5617 45.2537 44.0488 46.6455C44.103 46.9009 44.2437 47.1303 44.4463 47.2949C44.6489 47.4596 44.902 47.5501 45.1631 47.5508C45.4168 47.5502 45.663 47.4631 45.8604 47.3037C46.0578 47.1442 46.1951 46.9218 46.249 46.6738C46.6805 45.3375 47.1674 44.0707 47.6406 42.6787C47.6771 42.5547 47.7453 42.4417 47.8379 42.3516C47.9305 42.2616 48.0451 42.1971 48.1699 42.1641L52.248 40.6748C52.4769 40.61 52.6782 40.4708 52.8193 40.2793C52.9605 40.0878 53.0333 39.8541 53.0273 39.6162C53.0409 39.3885 52.9808 39.1622 52.8555 38.9717C52.7301 38.7812 52.5464 38.6363 52.332 38.5586C50.94 38.0575 49.5473 37.5429 48.1553 37.0557C48.034 37.0261 47.9232 36.9632 47.835 36.875C47.7466 36.7866 47.6839 36.6751 47.6543 36.5537C47.2367 35.2315 46.7498 33.965 46.2627 32.5732C46.2086 32.3178 46.0679 32.0885 45.8652 31.9238C45.6626 31.7592 45.4095 31.6687 45.1484 31.668ZM27.7178 13.2393C27.2743 13.2449 26.8456 13.4003 26.502 13.6807C26.1581 13.9613 25.9196 14.3505 25.8252 14.7842C24.9761 17.1088 24.1269 19.4334 23.3057 21.7441C23.2388 21.9604 23.1201 22.1573 22.96 22.3174C22.7999 22.4774 22.603 22.5962 22.3867 22.6631C20.0204 23.4983 17.6679 24.3753 15.3154 25.2383C14.9075 25.3426 14.547 25.5824 14.2939 25.9189C14.0409 26.2555 13.9097 26.6689 13.9229 27.0898C13.8985 27.5146 14.0249 27.9344 14.2793 28.2754C14.5339 28.6165 14.9011 28.8575 15.3154 28.9551C17.6956 29.832 20.062 30.7086 22.4561 31.5576C22.6603 31.6183 22.8464 31.7293 22.9971 31.8799C23.1478 32.0306 23.2587 32.2166 23.3193 32.4209C24.1545 34.7594 25.0037 37.0702 25.8389 39.3809C25.9405 39.8258 26.1874 40.224 26.54 40.5137C26.8928 40.8034 27.3318 40.9682 27.7881 40.9814C28.2328 40.9726 28.6615 40.814 29.0049 40.5312C29.3484 40.2484 29.5867 39.8578 29.6807 39.4229C30.5297 37.0983 31.379 34.7874 32.2002 32.4629C32.2671 32.2466 32.3858 32.0497 32.5459 31.8896C32.706 31.7296 32.9028 31.6108 33.1191 31.5439C35.5132 30.7088 37.8796 29.832 40.2598 28.9551C40.6655 28.8564 41.025 28.6209 41.2783 28.2891C41.5317 27.9572 41.6642 27.5482 41.6523 27.1309C41.6727 26.7066 41.5429 26.2886 41.2861 25.9502C41.0291 25.6117 40.6606 25.3746 40.2461 25.2803C37.8613 24.3802 35.4625 23.5075 33.0498 22.6631C32.8433 22.6023 32.6549 22.4894 32.5039 22.3359C32.3531 22.1826 32.244 21.9934 32.1865 21.7861C31.3514 19.4616 30.5024 17.1368 29.6533 14.8262C29.2636 13.7543 28.6226 13.2393 27.7178 13.2393Z"
                  fill="url(#paint0_radial_ai)"
                />
                <Defs>
                  <RadialGradient
                    id="paint0_radial_ai"
                    cx="0"
                    cy="0"
                    r="1"
                    gradientUnits="userSpaceOnUse"
                    gradientTransform="translate(35 31) rotate(90) scale(31)"
                  >
                    <Stop stopColor="#A0C6FF" offset="0" />
                    <Stop offset="1" stopColor="#579AFF" stopOpacity="0.85" />
                  </RadialGradient>
                </Defs>
              </Svg>
            </View>
            <View style={styles.aiDocentTextContainer}>
              <Text style={styles.aiDocentTitle}>
                Don&apos;t know where to go? Just ask me.
              </Text>
              <Text style={styles.aiDocentDescription}>
                Best travel route to find in conversation with AI Docent
              </Text>
            </View>
          </Pressable>

          {/* Ask AI Docent button */}
          <View style={styles.askAiButtonContainer}>
            <Pressable>
              <View style={styles.askAiButton}>
                <Svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <Path
                    d="M12 0C18.6274 4.63858e-06 23.9999 5.37264 24 12C24 18.6274 18.6274 24 12 24C5.37259 24 0 18.6274 0 12C6.03019e-05 5.37264 5.37263 0 12 0ZM15.9277 12.2588C15.8287 12.2583 15.7329 12.2927 15.6562 12.3555C15.5795 12.4184 15.5267 12.5061 15.5078 12.6035C15.3408 13.1154 15.152 13.6057 14.9688 14.1445C14.9537 14.1926 14.9273 14.2368 14.8916 14.2725C14.8561 14.3079 14.8125 14.3345 14.7646 14.3496L13.1963 14.915C13.1052 14.9392 13.0244 14.9931 12.9678 15.0684C12.9111 15.1436 12.8819 15.2359 12.8838 15.3301C12.8783 15.4235 12.9049 15.5161 12.96 15.5918C13.015 15.6675 13.095 15.7216 13.1855 15.7451L14.7695 16.3213C14.8153 16.3352 14.8568 16.3607 14.8906 16.3945C14.9245 16.4284 14.95 16.4698 14.9639 16.5156C15.1255 17.0275 15.3144 17.5178 15.5029 18.0566C15.5239 18.1554 15.5779 18.2439 15.6562 18.3076C15.7347 18.3714 15.8325 18.407 15.9336 18.4072C16.0317 18.407 16.1268 18.373 16.2031 18.3115C16.2795 18.2498 16.3326 18.1634 16.3535 18.0674C16.5206 17.5501 16.7094 17.0593 16.8926 16.5205C16.9067 16.4727 16.933 16.4293 16.9688 16.3945C17.0046 16.3596 17.0493 16.3341 17.0977 16.3213L18.6758 15.7451C18.7644 15.72 18.8428 15.6659 18.8975 15.5918C18.9519 15.5178 18.9797 15.4278 18.9775 15.3359C18.9828 15.2477 18.9597 15.1597 18.9111 15.0859C18.8626 15.0123 18.7919 14.9559 18.709 14.9258C18.1701 14.7318 17.6306 14.5323 17.0918 14.3438C17.0449 14.3323 17.0019 14.3085 16.9678 14.2744C16.9337 14.2403 16.9099 14.1972 16.8984 14.1504C16.7368 13.6386 16.5479 13.1481 16.3594 12.6094C16.3384 12.5106 16.2844 12.4211 16.2061 12.3574C16.1276 12.2937 16.0288 12.2591 15.9277 12.2588ZM9.18164 5.12402C9.00995 5.12624 8.84396 5.18733 8.71094 5.2959C8.57798 5.40451 8.48573 5.5549 8.44922 5.72266C8.12053 6.6225 7.79154 7.52253 7.47363 8.41699C7.44773 8.50063 7.40175 8.57676 7.33984 8.63867C7.2779 8.70058 7.20183 8.74659 7.11816 8.77246C6.20214 9.09576 5.2915 9.43545 4.38086 9.76953C4.22294 9.8099 4.08331 9.90292 3.98535 10.0332C3.88752 10.1634 3.83672 10.3235 3.8418 10.4863C3.83244 10.6507 3.88105 10.8134 3.97949 10.9453C4.07804 11.0774 4.22046 11.1703 4.38086 11.208C5.30225 11.5475 6.21872 11.8871 7.14551 12.2158C7.22431 12.2393 7.29631 12.2817 7.35449 12.3398C7.41283 12.3982 7.456 12.4707 7.47949 12.5498C7.80277 13.455 8.13083 14.3498 8.4541 15.2441C8.49345 15.4163 8.58914 15.5705 8.72559 15.6826C8.86213 15.7948 9.03236 15.8582 9.20898 15.8633C9.381 15.8599 9.5468 15.7987 9.67969 15.6895C9.81268 15.5799 9.90504 15.4282 9.94141 15.2598C10.2701 14.3599 10.5991 13.4652 10.917 12.5654C10.9429 12.4818 10.9889 12.4056 11.0508 12.3438C11.1127 12.2819 11.1888 12.2358 11.2725 12.21C12.1993 11.8867 13.1157 11.5475 14.0371 11.208C14.1941 11.1698 14.3336 11.0786 14.4316 10.9502C14.5296 10.8218 14.5807 10.6634 14.5762 10.502C14.5841 10.3376 14.5331 10.1759 14.4336 10.0449C14.3341 9.91389 14.1917 9.82167 14.0312 9.78516C13.1083 9.4368 12.1798 9.09928 11.2461 8.77246C11.1661 8.74893 11.0926 8.7049 11.0342 8.64551C10.9759 8.58619 10.9333 8.51273 10.9111 8.43262C10.5879 7.53289 10.2593 6.63262 9.93066 5.73828C9.77977 5.3237 9.53175 5.12402 9.18164 5.12402Z"
                    fill="white"
                  />
                </Svg>
                <Text style={styles.tryItText}>Ask AI Docent</Text>
                <Svg width="9" height="17" viewBox="0 0 9 17" fill="none" style={styles.askAiArrow}>
                  <Path
                    d="M0.235394 15.2704C0.160212 15.3499 0.101438 15.4435 0.0624246 15.5458C0.0234117 15.648 0.0049246 15.757 0.00801988 15.8664C0.0111152 15.9758 0.0357319 16.0836 0.0804641 16.1835C0.125196 16.2834 0.189168 16.3735 0.268727 16.4487C0.348286 16.5239 0.441875 16.5826 0.544149 16.6217C0.646423 16.6607 0.755379 16.6792 0.864798 16.6761C0.974216 16.673 1.08195 16.6483 1.18186 16.6036C1.28176 16.5589 1.37188 16.4949 1.44706 16.4154L8.53039 8.91535C8.67667 8.76063 8.75818 8.55578 8.75818 8.34285C8.75818 8.12993 8.67667 7.92508 8.53039 7.77035L1.44706 0.269518C1.37238 0.188217 1.28228 0.122565 1.18201 0.0763782C1.08174 0.030191 0.973286 0.00438871 0.862958 0.000468836C0.752629 -0.00345103 0.642621 0.014591 0.539324 0.0535455C0.436026 0.0925001 0.341498 0.15159 0.261231 0.227386C0.180964 0.303182 0.116557 0.394171 0.0717521 0.495068C0.0269469 0.595965 0.00263659 0.70476 0.000232852 0.815132C-0.00217088 0.925504 0.0173797 1.03525 0.0577497 1.13801C0.0981197 1.24076 0.158504 1.33447 0.235395 1.41368L6.77873 8.34285L0.235394 15.2704Z"
                    fill="white"
                  />
                </Svg>
              </View>
            </Pressable>
          </View>
        </>
      )}
    </ScrollView>

    {/* Bottom Route Selection Bar */}
    <View style={styles.routeContainer} pointerEvents="box-none">
      <LinearGradient
        colors={["#FF7F50", "#994C30"]}
        start={{ x: 0, y: 0 }}
        end={{ x: 1, y: 0 }}
        style={styles.routeBar}
      >
        <View style={styles.questSlotsContainer}>
          {[0, 1, 2, 3].map((index) => {
            const quest = selectedQuests[index];
            return (
              <Pressable
                key={index}
                style={styles.questSlot}
                onPress={() => quest && removeQuest(quest.id)}
              >
                {quest ? (
                  <Image
                    source={{
                      uri: quest.place_image_url || "https://picsum.photos/58/60",
                    }}
                    style={styles.slotQuestImage}
                  />
                ) : (
                  <Text style={styles.slotPlusIcon}>+</Text>
                )}
              </Pressable>
            );
          })}
        </View>

        <Pressable
          style={[
            styles.startButton,
            selectedQuests.length > 0 && styles.startButtonActive,
          ]}
          disabled={selectedQuests.length === 0}
          onPress={() => {
            if (selectedQuests.length > 0) {
              // Start the first quest and navigate to map
              const firstQuest = selectedQuests[0];
              startQuest(firstQuest);
              console.log("Quest started from Find tab:", {
                quest_id: firstQuest.id,
                place_id: firstQuest.place_id,
              });
              router.push("/(tabs)/map");
            }
          }}
        >
          <Text
            style={[
              styles.startButtonText,
              selectedQuests.length > 0 && styles.startButtonTextActive,
            ]}
          >
            START
          </Text>
        </Pressable>
      </LinearGradient>
    </View>
  </View>
  );
}

const styles = StyleSheet.create({
  outerContainer: {
    flex: 1,
    backgroundColor: "#34495E",
  },

  container: {
    flex: 1,
    backgroundColor: "#34495E",
  },

  fullHeader: {
    backgroundColor: "#34495E",
    paddingTop: 60,
    paddingHorizontal: 20,
    paddingBottom: 20,
  },

  topRow: {
    flexDirection: "row",
    gap: 8,
    alignItems: "center",
  },

  searchBox: {
    flex: 1,
    height: 50,
    backgroundColor: "#FFF",
    borderRadius: 35,
    flexDirection: "row",
    alignItems: "center",
    justifyContent: "space-between",
    paddingHorizontal: 20,
  },

  searchText: {
    color: "#34495E",
    fontFamily: "Pretendard",
    fontSize: 14,
    fontStyle: "normal",
    fontWeight: "500",
    lineHeight: 20,
    letterSpacing: -0.16,
  },

  walkBox: {
    width: 78,
    height: 50,
    backgroundColor: "#FF7F50",
    borderRadius: 35,
    flexDirection: "row",
    alignItems: "center",
    justifyContent: "space-between",
    paddingHorizontal: 10,
  },

  mintBox: {
    width: 98,
    height: 50,
    backgroundColor: "#76C7AD",
    borderRadius: 35,
    flexDirection: "row",
    alignItems: "center",
    justifyContent: "space-between",
    paddingHorizontal: 10,
  },

  statColumn: {
    flexDirection: "column",
    alignItems: "center",
    gap: 2,
  },

  statLabel: {
    color: "#FFF",
    fontFamily: "Pretendard",
    fontSize: 9,
    fontStyle: "normal",
    fontWeight: "400",
    lineHeight: 12,
    letterSpacing: 0,
  },

  statValue: {
    color: "#FFF",
    fontFamily: "Pretendard",
    fontSize: 16,
    fontStyle: "normal",
    fontWeight: "700",
    lineHeight: 22,
    letterSpacing: -0.18,
  },

  filterRowContainer: {
    flexDirection: "row",
    alignItems: "center",
    justifyContent: "space-between",
    marginTop: 14,
  },

  filterCategoryRow: {
    flexDirection: "row",
    alignItems: "center",
    flex: 1,
  },

  filterIcon: {
    marginRight: 20,
  },

  refreshButton: {
    width: 20,
    height: 20,
    marginRight: 10,
  },

  categoryChipActive: {
    display: "flex",
    paddingVertical: 7,
    paddingHorizontal: 10,
    justifyContent: "center",
    alignItems: "center",
    borderRadius: 42,
    backgroundColor: "#FF7F50",
    marginRight: 5,
  },

  categoryTextActive: {
    color: "#FFF",
    fontFamily: "Pretendard",
    fontSize: 13,
    fontStyle: "normal",
    fontWeight: "700",
    lineHeight: 16,
    letterSpacing: -0.12,
  },

  sortButtonActive: {
    display: "flex",
    paddingVertical: 7,
    paddingHorizontal: 10,
    justifyContent: "center",
    alignItems: "center",
    gap: 10,
    borderRadius: 42,
    backgroundColor: "#FFF",
    flexDirection: "row",
    marginRight: 5,
  },

  sortTextActive: {
    color: "#659DF2",
    fontFamily: "Pretendard",
    fontSize: 13,
    fontStyle: "normal",
    fontWeight: "700",
    lineHeight: 16,
    letterSpacing: -0.12,
  },

  districtChipActive: {
    display: "flex",
    paddingVertical: 7,
    paddingHorizontal: 10,
    justifyContent: "center",
    alignItems: "center",
    borderRadius: 42,
    backgroundColor: "#FFF",
    marginRight: 5,
  },

  districtTextActive: {
    color: "#659DF2",
    fontFamily: "Pretendard",
    fontSize: 13,
    fontStyle: "normal",
    fontWeight: "700",
    lineHeight: 16,
    letterSpacing: -0.12,
  },

  searchIcon: {
    marginRight: 10,
  },

  searchInput: {
    flex: 1,
    color: "#34495E",
    fontFamily: "Pretendard",
    fontSize: 14,
    fontWeight: "500",
    lineHeight: 20,
  },

  loadingContainer: {
    flex: 1,
    justifyContent: "center",
    alignItems: "center",
    paddingVertical: 40,
  },

  resultsContainer: {
    padding: 20,
  },

  resultsTitle: {
    color: "#FFF",
    fontFamily: "Pretendard",
    fontSize: 18,
    fontWeight: "700",
    marginBottom: 16,
  },

  resultsGrid: {
    flexDirection: "row",
    flexWrap: "wrap",
    gap: 12,
  },

  cardWrapper: {
    width: "48%",
    marginBottom: 12,
  },

  placeImageContainer: {
    position: "relative",
    width: "100%",
    height: 160,
    borderRadius: 12,
    overflow: "hidden",
    backgroundColor: "#2C3E50",
  },

  placeImage: {
    width: "100%",
    height: "100%",
    resizeMode: "cover",
  },

  placeCategoryText: {
    position: "absolute",
    top: 8,
    left: 8,
    color: "#FFF",
    fontFamily: "Pretendard",
    fontSize: 11,
    fontWeight: "600",
    backgroundColor: "rgba(0, 0, 0, 0.5)",
    paddingHorizontal: 8,
    paddingVertical: 4,
    borderRadius: 4,
  },

  plusButton: {
    position: "absolute",
    top: 5,
    right: 5,
    width: 38,
    height: 38,
    padding: 11,
    borderRadius: 10,
    backgroundColor: "rgba(255, 127, 80, 0.85)",
    justifyContent: "center",
    alignItems: "center",
  },

  distanceBadge: {
    position: "absolute",
    bottom: 8,
    left: 8,
    flexDirection: "row",
    alignItems: "center",
    gap: 4,
    backgroundColor: "rgba(0, 0, 0, 0.5)",
    paddingHorizontal: 8,
    paddingVertical: 4,
    borderRadius: 12,
  },

  distanceText: {
    color: "#F5F5F5",
    fontFamily: "Pretendard",
    fontSize: 11,
    fontWeight: "600",
  },

  placeInfoBottom: {
    marginTop: 8,
  },

  placeNameText: {
    color: "#FFF",
    fontFamily: "Pretendard",
    fontSize: 14,
    fontWeight: "700",
    lineHeight: 18,
    marginBottom: 4,
  },

  placeLocationText: {
    color: "rgba(255, 255, 255, 0.7)",
    fontFamily: "Pretendard",
    fontSize: 12,
    fontWeight: "400",
  },

  noResultsContainer: {
    flex: 1,
    justifyContent: "center",
    alignItems: "center",
    paddingVertical: 60,
    paddingHorizontal: 20,
  },

  docentFaceImage: {
    width: 120,
    height: 120,
    marginBottom: 20,
  },

  oopsText: {
    marginBottom: 20,
  },

  noResultsTextContainer: {
    alignItems: "center",
  },

  noResultsText: {
    textAlign: "center",
  },

  noResultsRegular: {
    color: "#FEF5E7",
    fontFamily: "Pretendard",
    fontSize: 16,
    fontWeight: "400",
  },

  noResultsBold: {
    color: "#FEF5E7",
    fontFamily: "Pretendard",
    fontSize: 16,
    fontWeight: "700",
  },

  recommendationCard: {
    flexDirection: "row",
    padding: 20,
    alignItems: "center",
    gap: 20,
    borderRadius: 10,
    borderWidth: 1,
    borderColor: "#FEF5E7",
    backgroundColor: "#FEF5E7",
    shadowColor: "#000",
    shadowOffset: { width: 0, height: 4 },
    shadowOpacity: 0.25,
    shadowRadius: 4,
    elevation: 4,
    marginTop: 20,
    marginBottom: 10,
  },

  cardImagesContainer: {
    position: "relative",
    width: 65,
    height: 66,
  },

  rionImage: {
    width: 65,
    height: 66,
    transform: [{ rotate: "-15deg" }],
    position: "absolute",
    top: -15,
    left: 0,
  },

  mapIconImage: {
    width: 40,
    height: 40,
    transform: [{ rotate: "15deg" }],
    position: "absolute",
    bottom: -20,
    right: -15,
  },

  cardTextContainer: {
    flex: 1,
    flexDirection: "column",
    alignItems: "flex-start",
    gap: 10,
  },

  cardTitle: {
    color: "#4A90E2",
    fontFamily: "Inter",
    fontSize: 16,
    fontWeight: "700",
    lineHeight: 22,
    letterSpacing: -0.18,
    textAlign: "left",
  },

  cardDescription: {
    color: "#4A90E2",
    fontFamily: "Pretendard",
    fontSize: 14,
    fontWeight: "400",
    lineHeight: 20,
    letterSpacing: -0.16,
    textAlign: "left",
  },

  tryItButtonContainer: {
    marginBottom: 54,
    shadowColor: "#000",
    shadowOffset: { width: 0, height: 4 },
    shadowOpacity: 0.25,
    shadowRadius: 4,
    elevation: 4,
    borderRadius: 10,
  },

  tryItButton: {
    height: 47,
    flexShrink: 0,
    borderRadius: 10,
    flexDirection: "row",
    alignItems: "center",
  },

  tryItIcon: {
    marginLeft: 13,
  },

  tryItText: {
    color: "#FFF",
    fontFamily: "Inter",
    fontSize: 14,
    fontWeight: "400",
    marginLeft: 8,
    flex: 1,
  },

  tryItArrow: {
    marginRight: 17,
  },

  aiDocentCard: {
    padding: 20,
    alignItems: "center",
    gap: 20,
    borderRadius: 10,
    borderWidth: 1,
    borderColor: "#FEF5E7",
    backgroundColor: "#FEF5E7",
    flexDirection: "row",
    shadowColor: "#000",
    shadowOffset: { width: 0, height: 4 },
    shadowOpacity: 0.25,
    shadowRadius: 4,
    elevation: 4,
    marginBottom: 10,
  },

  aiDocentIconContainer: {
    padding: 20,
    alignItems: "center",
    gap: 10,
    flex: 1,
    borderRadius: 10,
    backgroundColor: "#FFF",
  },

  aiDocentTextContainer: {
    width: 161.865,
    flexDirection: "column",
    alignItems: "flex-start",
    gap: 10,
    flexShrink: 0,
  },

  aiDocentTitle: {
    color: "#4A90E2",
    fontFamily: "Inter",
    fontSize: 16,
    fontWeight: "700",
    lineHeight: 22,
    letterSpacing: -0.18,
    textAlign: "left",
  },

  aiDocentDescription: {
    color: "#4A90E2",
    fontFamily: "Pretendard",
    fontSize: 14,
    fontWeight: "400",
    lineHeight: 20,
    letterSpacing: -0.16,
    textAlign: "left",
  },

  askAiButtonContainer: {
    marginBottom: 20,
    shadowColor: "#000",
    shadowOffset: { width: 0, height: 4 },
    shadowOpacity: 0.25,
    shadowRadius: 4,
    elevation: 4,
    borderRadius: 10,
  },

  askAiButton: {
    height: 47,
    flexShrink: 0,
    borderRadius: 10,
    backgroundColor: "#8FB6F1",
    flexDirection: "row",
    alignItems: "center",
    paddingHorizontal: 13,
  },

  askAiArrow: {
    marginRight: 2,
  },

  // Bottom Route Selection Bar
  routeContainer: {
    position: "absolute",
    bottom: 30,
    left: 0,
    right: 0,
    alignItems: "center",
    zIndex: 1600,
    elevation: 1600,
  },
  routeBar: {
    width: 325,
    height: 73,
    borderRadius: 20,
    paddingHorizontal: 8.68,
    paddingVertical: 6.5,
    flexDirection: "row",
    alignItems: "center",
    gap: 4.82,
    shadowColor: "#000",
    shadowOffset: { width: 0, height: 4 },
    shadowOpacity: 0.3,
    shadowRadius: 12,
    elevation: 8,
  },
  questSlotsContainer: {
    flexDirection: "row",
    gap: 4.82,
  },
  questSlot: {
    width: 58,
    height: 60,
    backgroundColor: "#EF6A39",
    borderRadius: 10,
    justifyContent: "center",
    alignItems: "center",
    shadowColor: "#000",
    shadowOffset: { width: 2, height: 2 },
    shadowOpacity: 0.25,
    shadowRadius: 2,
    elevation: 4,
    overflow: "hidden",
  },
  slotQuestImage: {
    width: 58,
    height: 60,
    borderRadius: 10,
  },
  slotPlusIcon: {
    fontSize: 32,
    fontWeight: "300",
    color: "#fff",
    textAlign: "center",
    lineHeight: 32,
    textShadowColor: "rgba(0, 0, 0, 0.25)",
    textShadowOffset: { width: 2, height: 2 },
    textShadowRadius: 1,
  },
  startButton: {
    width: 58,
    height: 60,
    backgroundColor: "#EF6A39",
    borderRadius: 10,
    justifyContent: "center",
    alignItems: "center",
    shadowColor: "#000",
    shadowOffset: { width: 2, height: 2 },
    shadowOpacity: 0.25,
    shadowRadius: 2,
    elevation: 4,
  },
  startButtonActive: {
    backgroundColor: "#FFFFFF",
  },
  startButtonText: {
    fontSize: 14,
    fontWeight: "500",
    color: "rgba(154, 77, 49, 0.46)",
    textAlign: "center",
    lineHeight: 20,
    letterSpacing: -0.16,
  },
  startButtonTextActive: {
    color: "#EF6A39",
    fontFamily: "Inter",
    fontSize: 14,
    fontWeight: "500",
    lineHeight: 20,
    letterSpacing: -0.16,
  },
});
